<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dei-GO | Route Assistant</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

  <style>
    body {
      margin: 0;
      font-family: "Poppins", sans-serif;
      background-color: #eef2ff;
      text-align: center;
    }

    header {
      background-color: #1e2a78;
      color: white;
      padding: 20px 0;
    }

    .hero {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 20px;
      margin-top: 30px;
    }

    .card {
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      width: 250px;
      transition: transform 0.3s;
    }

    .card:hover {
      transform: translateY(-5px);
    }

    .card img {
      width: 100%;
      border-radius: 12px 12px 0 0;
      height: 160px;
      object-fit: cover;
    }

    .card h3 {
      margin: 10px 0 5px;
      color: #1e2a78;
    }

    .card p {
      color: #555;
      font-size: 0.9rem;
      margin-bottom: 15px;
    }

    .route-section {
      margin: 40px auto;
      width: 80%;
      max-width: 700px;
      text-align: center;
    }

    #map {
      height: 400px;
      width: 80%;
      max-width: 900px;
      margin: 30px auto;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    }

    select, button {
      margin: 10px;
      padding: 10px 15px;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 1rem;
    }

    button {
      background-color: #4f46e5;
      color: white;
      border: none;
      cursor: pointer;
    }

    button:hover {
      background-color: #4338ca;
    }

    #result {
      margin-top: 15px;
      font-size: 1.1rem;
    }

    /* === Chatbot Styles === */
    #chatbot-button {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background-color: #4f46e5;
      color: white;
      font-size: 26px;
      border: none;
      border-radius: 50%;
      width: 60px;
      height: 60px;
      cursor: pointer;
      box-shadow: 0 4px 10px rgba(0,0,0,0.3);
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    #chatbot-container {
      position: fixed;
      bottom: 90px;
      right: 20px;
      width: 320px;
      background: white;
      border-radius: 16px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.25);
      overflow: hidden;
      display: none;
      flex-direction: column;
      z-index: 1001;
      animation: fadeIn 0.3s ease-in-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    #chatbot-header {
      background: #1e2a78;
      color: white;
      padding: 10px;
      font-weight: bold;
    }

    #chatbot-messages {
      height: 300px;
      padding: 10px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 8px;
      scroll-behavior: smooth;
    }

    .bot-msg {
      background: #eef2ff;
      padding: 8px 12px;
      border-radius: 10px;
      text-align: left;
      max-width: 80%;
      align-self: flex-start;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    .user-msg {
      background: #4f46e5;
      color: white;
      padding: 8px 12px;
      border-radius: 10px;
      text-align: right;
      max-width: 80%;
      align-self: flex-end;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    #chatbot-input {
      display: flex;
      border-top: 1px solid #ddd;
    }

    #user-input {
      flex: 1;
      padding: 8px;
      border: none;
      outline: none;
      font-size: 0.9rem;
    }

    #send-btn {
      background: #4f46e5;
      color: white;
      border: none;
      padding: 8px 15px;
      cursor: pointer;
    }

    #send-btn:hover {
      background: #4338ca;
    }

    /* üí¨ animasi pop */
    .chatbot-pop {
      position: fixed;
      font-size: 24px;
      opacity: 1;
      transition: all 0.6s ease;
      pointer-events: none;
      z-index: 2000;
    }
  </style>
</head>

<body>
  <header>
    <h1>üß≠ Dei-GO</h1>
    <p>AI Route Assistant for Yogyakarta City Destinations</p>
  </header>

  <!-- Section Foto -->
  <section class="hero">
    {% for name, image, desc in [
      ('Tugu Jogja', 'tugu.jpg', 'A historical landmark in Yogyakarta'),
      ('Malioboro', 'malioboro.jpg', 'One of the famous shopping streets in Yogyakarta'),
      ('Keraton', 'keraton.jpg', 'The magnificent Sultan‚Äôs Palace'),
      ('UGM', 'ugm.jpg', 'Universitas Gadjah Mada of DIY'),
      ('Airport DIY', 'bandara.jpg', 'Yogyakarta International Airport')
    ] %}
    <div class="card">
      <img src="{{ url_for('static', filename='images/' + image) }}" alt="{{ name }}">
      <h3>{{ name }}</h3>
      <p>{{ desc }}</p>
    </div>
    {% endfor %}
  </section>

  <!-- Section Form -->
  <section class="route-section">
    <h2>Select Your Route</h2>
    <div>
      <label>Origin:</label>
      <select id="start">
        <option value="">Select Origin</option>
        <option value="Tugu Jogja">Tugu Jogja</option>
        <option value="Stasiun Tugu">Stasiun Tugu</option>
        <option value="Malioboro">Malioboro</option>
        <option value="Keraton">Keraton</option>
        <option value="Alun-Alun Kidul">Alun-Alun Kidul</option>
        <option value="UGM">UGM</option>
        <option value="Monjali">Monjali</option>
        <option value="Bandara">Bandara</option>
      </select>

      <label>Destination:</label>
      <select id="end">
        <option value="">Select Destination</option>
        <option value="Tugu Jogja">Tugu Jogja</option>
        <option value="Stasiun Tugu">Stasiun Tugu</option>
        <option value="Malioboro">Malioboro</option>
        <option value="Keraton">Keraton</option>
        <option value="Alun-Alun Kidul">Alun-Alun Kidul</option>
        <option value="UGM">UGM</option>
        <option value="Monjali">Monjali</option>
        <option value="Bandara">Bandara</option>
      </select>

      <button onclick="findRoute()">Find Route</button>
    </div>
    <div id="result"></div>
  </section>

  <!-- Map -->
  <div id="map"></div>

  <!-- === Chatbot Floating Button & Window === -->
  <div id="chatbot-button">üí¨</div>

  <div id="chatbot-container">
    <div id="chatbot-header">Dei-GO Chatbot ü§ñ</div>
    <div id="chatbot-messages"></div>
    <div id="chatbot-input">
      <input type="text" id="user-input" placeholder="Ketik pertanyaan..." />
      <button id="send-btn">Kirim</button>
    </div>
  </div>

  <!-- === Scripts === -->
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script src="{{ url_for('static', filename='chatbot.js') }}"></script>

  <script>
    // === MAP SETUP ===
    const locations = {
      "Tugu Jogja": [-7.7829, 110.3671],
      "Stasiun Tugu": [-7.7891, 110.3638],
      "Malioboro": [-7.7930, 110.3658],
      "Keraton": [-7.8056, 110.3649],
      "Alun-Alun Kidul": [-7.8125, 110.3630],
      "UGM": [-7.7700, 110.3776],
      "Monjali": [-7.7475, 110.3705],
      "Bandara": [-7.9053, 110.0567]
    };

    const map = L.map('map').setView([-7.79, 110.366], 13);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    let routeLine = null;
    let markers = [];

    async function findRoute() {
      const start = document.getElementById('start').value;
      const end = document.getElementById('end').value;
      const resultDiv = document.getElementById('result');

      if (!start || !end) {
        resultDiv.innerText = "Please select both origin and destination.";
        return;
      }

      const res = await fetch('/api/route', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({ start, end })
      });

      const data = await res.json();
      if (data.error) {
        resultDiv.innerHTML = `‚ùå Error: ${data.error}`;
        return;
      }

      resultDiv.innerHTML = `üöó <b>Rute:</b> ${data.route.join(' ‚Üí ')}<br>üìè <b>Jarak:</b> ${data.distance} km`;

      if (routeLine) map.removeLayer(routeLine);
      markers.forEach(m => map.removeLayer(m));
      markers = [];

      const coords = data.route.map(r => locations[r]).filter(Boolean);
      routeLine = L.polyline(coords, { color: 'blue', weight: 4 }).addTo(map);

      coords.forEach((c, i) => {
        markers.push(L.marker(c).addTo(map).bindPopup(`<b>${data.route[i]}</b>`));
      });

      map.fitBounds(coords);
    }
  </script>
</body>
</html>
